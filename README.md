# Проект «YaMDb» http://bgyatube.ddns.net

![example workflow](https://github.com/bndgrave/yamdb_final/actions/workflows/yamdb_workflow.yml/badge.svg)

## Описание
Проект YaMDb собирает отзывы (**Review**) пользователей на произведения (**Titles**). Произведения делятся на категории: "Книги", "Фильмы", "Музыка". Список категорий (**Category**) может быть расширен администратором (например, можно добавить категорию «Изобразительное искусство» или «Ювелирка»).

Сами произведения в YaMDb не хранятся, здесь нельзя посмотреть фильм или послушать музыку.

В каждой категории есть произведения: книги, фильмы или музыка. Например, в категории «Книги» могут быть произведения «Винни-Пух и все-все-все» и «Марсианские хроники», а в категории «Музыка» — песня «Давеча» группы «Насекомые» и вторая сюита Баха.

Произведению может быть присвоен жанр (**Genre**) из списка предустановленных (например, «Сказка», «Рок» или «Артхаус»). Новые жанры может создавать только администратор.

Благодарные или возмущённые пользователи оставляют к произведениям текстовые отзывы (**Review**) и ставят произведению оценку в диапазоне от одного до десяти (целое число); из пользовательских оценок формируется усреднённая оценка произведения — **рейтинг** (целое число). На одно произведение пользователь может оставить только один отзыв.

---
## Пользовательские роли

- ***Аноним*** — может просматривать описания произведений, читать отзывы и комментарии.


- ***Аутентифицированный пользователь (user)*** — может читать всё, как и Аноним, может публиковать отзывы и ставить оценки произведениям (фильмам/книгам/песенкам), может комментировать отзывы; может редактировать и удалять свои отзывы и комментарии, редактировать свои оценки произведений. Эта роль присваивается по умолчанию каждому новому пользователю.


- ***Модератор (moderator)*** — те же права, что и у Аутентифицированного пользователя, плюс право удалять и редактировать любые отзывы и комментарии.


- ***Администратор (admin)*** — полные права на управление всем контентом проекта. Может создавать и удалять произведения, категории и жанры. Может назначать роли пользователям.


- ***Суперюзер Django*** должен всегда обладать правами администратора, пользователя с правами admin. Даже если изменить пользовательскую роль суперюзера — это не лишит его прав администратора. Суперюзер — всегда администратор, но администратор — не обязательно суперюзер.

---
## Самостоятельная регистрация новых пользователей
1. Пользователь отправляет POST-запрос с параметрами ```email``` и ```username``` на эндпоинт ```/api/v1/auth/signup/```.
2. Сервис YaMDB отправляет письмо с кодом подтверждения (```confirmation_code```) на указанный адрес ```email```.
3. Пользователь отправляет POST-запрос с параметрами ```username``` и ```confirmation_code``` на эндпоинт ```/api/v1/auth/token/```, в ответе на запрос ему приходит ```token``` (JWT-токен).

В результате пользователь получает токен и может работать с API проекта, отправляя этот токен с каждым запросом.
После регистрации и получения токена пользователь может отправить PATCH-запрос на эндпоинт ```/api/v1/users/me/``` и заполнить поля в своём профайле (описание полей — в документации).

---

## Создание пользователя администратором

Пользователя может создать администратор — через админ-зону сайта или через POST-запрос на специальный эндпоинт ```api/v1/users/``` (описание полей запроса для этого случая — в документации). В этот момент письмо с кодом подтверждения пользователю отправлять не нужно.
После этого пользователь должен самостоятельно отправить свой ```email``` и ```username``` на эндпоинт  ```/api/v1/auth/signup/```  , в ответ ему должно прийти письмо с кодом подтверждения.
Далее пользователь отправляет POST-запрос с параметрами ```username``` и ```confirmation_code``` на эндпоинт ```/api/v1/auth/token/```, в ответе на запрос ему приходит ```token``` (JWT-токен), как и при самостоятельной регистрации.

---
## Ресурсы API YaMDb
- Ресурс **auth**: аутентификация.
- Ресурс **users**: пользователи.
- Ресурс **titles**: произведения, к которым пишут отзывы (определённый фильм, книга или песенка).
- Ресурс **categories**: категории (типы) произведений («Фильмы», «Книги», «Музыка»).
- Ресурс **genres**: жанры произведений. Одно произведение может быть привязано к нескольким жанрам.
- Ресурс **reviews**: отзывы на произведения. Отзыв привязан к определённому произведению.
- Ресурс **comments**: комментарии к отзывам. Комментарий привязан к определённому отзыву.

Каждый ресурс описан в документации: указаны эндпоинты (адреса, по которым можно сделать запрос), разрешённые типы запросов, права доступа и дополнительные параметры, если это необходимо.

---
## Как запустить проект:

Клонировать репозиторий и перейти в него в командной строке:

```
git clone https://github.com/yandex-praktikum/api_yamdb.git
```

```
cd api_yamdb
```

Перейти в папку /infra и развернуть контейнеры Docker:

```
cd infra
```
```
docker-compose up -d --build
```

Выполнить миграции и заполнить базу данных:
```
docker-compose exec web python manage.py migrate
```
```
docker-compose exec web python manage.py loaddata fixtures.json 
```

Cоздать учетную запись суперпользователя и собрать статику:
```
docker-compose exec web python manage.py createsuperuser
docker-compose exec web python manage.py collectstatic --no-input 
```
---
## Работа с API
Когда вы запустите проект, по адресу http://localhost/redoc/ будет доступна документация для API Yatube. В документации описано, как работать с API. Документация представлена в формате Redoc и содержит наглядные примеры запросов.
### Примеры API запросов

---
***Регистрация пользователя***
- POST [http://localhost/api/v1/auth/signup/](http://localhost/api/v1/auth/signup/ "http://localhost/api/v1/auth/signup/")

Request samples
```json
{
  "email": "string",
  "username": "string"
}
```
Response samples
>Статус 200 - удачное выполнение запроса
```json
{
  "email": "string",
  "username": "string"
}
```
>Статус 404 - Отсутствует обязательное поле или оно некорреткно

```json
{
  "field_name": [
    "string"
  ]
}
```
---
***Получение списка всех категорий***
- GET [http://localhost/api/v1/categories/](http://localhost/api/v1/categories/ "http://localhost/api/v1/categories/")

Response samples
>Статус 200 - удачное выполнение запроса
 
```json
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "name": "string",
        "slug": "string"
      }
    ]
  }
]
```
---
***Получение списка всех жанров***
- GET [http://localhost/api/v1/genres/](http://127.0.0.1:8000/api/v1/genres/ "http://localhost/api/v1/genres/")

Response samples
>Статус 200 - удачное выполнение запроса
 
```json
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "name": "string",
        "slug": "string"
      }
    ]
  }
]
```
---
***Получение списка всех произведений***
- GET [http://localhost/api/v1/titles//{id}/](http://localhost/api/v1/titles/ "http://localhost/api/v1/titles/")

Response samples
>Статус 200 - удачное выполнение запроса

```json
[
  {
    "count": 0,
    "next": "string",
    "previous": "string",
    "results": [
      {
        "id": 0,
        "name": "string",
        "year": 0,
        "rating": 0,
        "description": "string",
        "genre": [
          {
            "name": "string",
            "slug": "string"
          }
        ],
        "category": {
          "name": "string",
          "slug": "string"
        }
      }
    ]
  }
]
```
---
***Получение информации о произведении***
- GET [http://localhost/api/v1/titles/{titles_id}/](http://localhost/api/v1/titles/{titles_id}/ "http://localhost/api/v1/titles/{titles_id}/")

Response samples
>Статус 200 - удачное выполнение запроса

```json
{
  "id": 0,
  "name": "string",
  "year": 0,
  "rating": 0,
  "description": "string",
  "genre": [
    {
      "name": "string",
      "slug": "string"
    }
  ],
  "category": {
    "name": "string",
    "slug": "string"
  }
}
```
>Статус 404 - Объект не найден
---
### Технологии проекта

- Python
- Django
- Django REST framework

---
### Авторы:

- [mv-31](https://github.com/mv-31/ "mv-31")
- [bndgrave](https://github.com/bndgrave/ "bndgrave")
- [single1709](https://github.com/single1709/ "single1709")

**Студенты факультета Backend-разработки в Яндекс.Практикум.**
